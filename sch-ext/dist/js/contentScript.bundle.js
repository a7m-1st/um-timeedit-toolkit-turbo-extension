(()=>{"use strict";var e={510:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function c(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}l((o=o.apply(e,t||[])).next())}))};function o(e,t){return n(this,void 0,void 0,(function*(){try{const n=yield fetch(`${e}objects/${t}/o.json?fr=t&types=15&sid=5&l=en_US`);return n.ok?yield n.json():null}catch(e){return null}}))}function r(e,t){return n(this,void 0,void 0,(function*(){const t=e;if(!t||!t.idOnly)throw t.events=null,new Error("Object idOnly is null");{const e=yield function(e,t){return n(this,void 0,void 0,(function*(){try{const n=yield fetch(e+"ri.json?h=f&sid=3&p=0.m,12.n&objects="+t+"&ox=0&types=0&fe=0&h2=f&l=en_EN");if(!n.ok)return null;const o=yield n.json();if(!o||!o.reservations||!o.columnheaders)return console.error("Invalid data format received from TimeEdit API"),null;const r=o.reservations.map((e=>Object.assign(Object.assign({},e),{additional_info:o.columnheaders.reduce(((t,n,o)=>(t[n]=e.columns[o],t)),{})})));return Object.assign(Object.assign({},o),{reservations:r})}catch(e){return console.error("Error fetching course events:",e.message),null}}))}(i,t.idOnly);if(t.events=e?e.reservations:null,t.events){t.events.length;const e=t.events.map((e=>n(this,void 0,void 0,(function*(){const t=yield function(e,t){return n(this,void 0,void 0,(function*(){try{const n=`${e}ri.html?h=f&sid=3&types=4&fe=0&h2=f&l=en_EN&id=${t}&fr=t&step=0&ef=2&nocache=2`,o=yield fetch(n);return o.ok?yield o.text():null}catch(e){return console.error(`Error fetching reservation details HTML for ID ${t}:`,e.message),null}}))}(i,e.id),o=t?yield function(e){return n(this,void 0,void 0,(function*(){if(!e)return null;const t={},n=(new DOMParser).parseFromString(e,"text/html").querySelector(".detailedResObjects");if(n){const e=Array.from(n.querySelectorAll("tr"));for(const n of e){const e=n.querySelector(".columnname"),o=n.querySelector(".pr");if(e&&o){const n=e.textContent.trim(),r=o.textContent.trim();t[n]=r}}}return t}))}(t):null,r={reservation:e,details:o};r.reservation.html_details=r.details}))));return yield Promise.all(e)}}}))}function s(e){chrome.runtime.sendMessage({type:"PROGRESS_UPDATE",size:e.toFixed(2)})}Object.defineProperty(t,"__esModule",{value:!0}),t.startProcess=void 0;let i="https://cloud.timeedit.net/my_um/web/students/";"/"!==i[i.length-1]&&(i+="/");const c="course_events_with_details.json";t.startProcess=function(e,t){try{return t?function(e,t=29e3){return n(this,void 0,void 0,(function*(){const i=`${e}objects.html?max=100&fr=t&partajax=t&im=f&sid=4&l=en_US&objects=&types=15&part=t&media=html`;let c=[];const l=Math.ceil(t/100),a=[];for(let d=0;d<l;d++){const l=100*d,u=(()=>n(this,void 0,void 0,(function*(){const a=`${i}&start=${l}`;try{const i=yield fetch(a);if(!i.ok)return console.error(`HTTP error! status: ${i.status}`),[];const d=yield i.text(),u=(new DOMParser).parseFromString(d,"text/html"),h=Array.from(u.querySelectorAll("[data-idonly]")).map((i=>n(this,void 0,void 0,(function*(){try{if(c.length>=t)throw new Error("Max Items Reached");const n=i.dataset.idonly,l=i.dataset.name,a=yield o(e,n),d={id:i.dataset.id,idOnly:i.dataset.idonly,type:i.dataset.type,name:l,events:null,details:a};yield r(d),c.length<t&&(c.push(d),console.log(`Progress: ${c.length}/${t}`),s(c.length/t*100))}catch(e){if("Max Items Reached"===e.message)return c;console.error("Error processing object:",e)}}))));if(0===h.length)return[];{const e=yield Promise.allSettled(h),n=u.querySelector(".searchResultCount");let o=null;if(n){const e=n.textContent.trim().replace(/\D/g,"");o=parseInt(e,10)}const r=l+1,s=l+e.length;if(console.log(`Objects ${r}-${s} processed. Events found for e 0 objects.`),null!==o&&c.length>=Math.min(o,t))return[]}}catch(e){return console.error(`Error fetching batch starting at ${l}:`,e),[]}})))();a.push(u)}return yield Promise.all(a),c.slice(0,t)}))}(i,e).then((e=>{const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=c,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)})):function(e,t=29e3){return n(this,void 0,void 0,(function*(){let i=[],c=0;const l=`${e}objects.html?max=100&fr=t&partajax=t&im=f&sid=4&l=en_US&objects=&types=15&part=t&media=html`;for(;i.length<t;){let a=0;const d=`${l}&start=${c}`;try{const l=yield fetch(d);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const u=yield l.text(),h=(new DOMParser).parseFromString(u,"text/html"),f=Array.from(h.querySelectorAll("[data-idonly]")).map((c=>n(this,void 0,void 0,(function*(){try{if(i.length>=t)throw new Error("Max Items Reached");const n=c.dataset.idonly,l=c.dataset.name,a=yield o(e,n),d={id:c.dataset.id,idOnly:c.dataset.idonly,type:c.dataset.type,name:l,events:null,details:a};yield r(d),i.length<t&&(i.push(d),console.log(`Progress: ${i.length}/${t}`),s(i.length/t*100))}catch(e){if("Max Items Reached"===e.message)return i;console.error("Error processing object:",e)}}))));if(0!==f.length){const e=yield Promise.allSettled(f),n=h.querySelector(".searchResultCount");let o=null;if(n){const e=n.textContent.trim().replace(/\D/g,"");o=parseInt(e,10)}const r=c+1,s=c+e.length;if(console.log(`Objects ${r}-${s} processed. Events found for e ${a} objects.`),null!==o&&i.length>=Math.min(o,t))break;if(0===e.length)break;c+=100}}catch(e){console.error("Error fetching data:",e);break}}return i.slice(0,t)}))}(i,e).then((e=>{const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=c,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)})),c}catch(e){return console.log("Error caught at main.js:startProcess()"),""}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(()=>{const e=n(510);var t=chrome.runtime.connect({name:"knocker"});console.log("Content Script Loaded"),chrome.runtime.onMessage.addListener((function(t,n,o){console.log("The message is ",t),t.action&&("start"===t.action?(t.turboMode&&console.log("Turbo Mode"),(0,e.startProcess)(t.maxItemsToFetch,t.turboMode),o({response:"Processing"})):"PROGRESS_UPDATE"===t.action&&chrome.runtime.sendMessage(t))})),chrome.runtime.onSuspend.addListener((function(){console.log("Clearning Worker"),t.disconnect()}))})()})();